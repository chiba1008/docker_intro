# イメージの利用と開発を体験しよう
## イメージを探索する
```docker search```  
searchに続けて検索キーワードを指定すると、デフォルトでSTARS順でリポジトリが表示される。
<br>
## イメージをPullして確認する
```docker pull```  
で任意のタイミングでイメージのダウンロードができる。**一度ダウンロードしたイメージはローカルにキャッシュされる**ので、2度目のPullではダウンロードが発生しない。  
ローカルに存在するイメージの一覧は  
```docker image ls```  
コマンドで確認できる。  
<br>
## イメージを削除する
```docker image rm <イメージ名>```  
でイメージを指定して削除する。ただし、そのイメージがコンテナ(停止しているものも含む)に利用されていると消せない。  
<br>
## イメージを作成してレジストリに登録する
### イメージ作成から登録までの流れ
1. pythonのイメージからコンテナをbashコマンドを指定して起動する。
2. pythonにアプリサーバー用のパッケージであるflaskをインストールする。
3. アプリサーバーのコードを手元のPCからコンテナ内にコピーする。
4. コンテナでアプリサーバを起動する。
5. コンテナをイメージ化する。
6. イメージにユーザー名とタグを加えて改名する。
7. 改名したイメージをレジストリに登録する。

### コンテナを起動してパッケージをインストール
flaskをインストール
```docker container run --name base -it -p 8080:80 python:3.7.5-slim bash #コンテナの起動```
```pip install flask```

### ホストからコンテナにファイルを送る
PythonのソースコードをホストのPCで作成し以下のコマンドでコンテナに転送する。
```docker container cp <コピー元><コピー先>```
コンテナのパスは「コンテナ名:コンテナ内のパス」という形式で指定する。  
逆にコンテナからコマンドの実行元にファイルをコピーすることも可能。

### コンテナを停止してイメージ化する
作成したアプリサーバーのコンテナをイメージ化する。  
手動によるコンテナのイメージ化には、ベースとなるコンテナの停止が必要。`exit`コマンドでコンテナを停止する。  
コンテナを停止したら、  
```docker container commit <コンテナ名><イメージ名>```  
コマンドで、指定したコンテナをイメージ化する。イメージ化に成功したら、イメージのハッシュ値が表示される。  
イメージを作成できたら、`docker image ls`で作成したイメージを確認でき、そのイメージからコンテナを展開することができる。  
このイメージからコンテナを展開すれば、pipでのインストールやファイルのコピーをしなくてもアプリサーバーを起動できる。  

### イメージの階層構造について
Dockerのイメージは**複数の「差分」を持つイメージの階層構造**から作られている。  
この積み重なったレイヤーは**差分ファイル**と呼ばれる。この差分ファイルは「**Aという状態を内部的にキープしたまま、上のレイヤーのBを合体させることで現在の状態も保つ**」という特徴を持つ。

### イメージにタグ付けする
イメージのpushを行うためには、「**ユーザー名/イメージ名:タグ名**」という形式にしなければならない。タグ名は省略すれば「latest」となるが、イメージのバージョン管理をするため任意の一貫性を持つタグ名を付けることが望ましい。  
イメージ名とタグの変更には、  
```docker image tag <元の名前><新しい名前>```  
コマンドを使う。

### レジストリ（DockerHub）へのPush
レジストリへの登録にはDockerHubへのログインが必要なので  
```docker login```コマンドでログインする。  
ログインした状態で、  
```docker image push <イメージ名>```
コマンドでリポジトリに追加される。



